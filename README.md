# files_transfer


Логика работы программы:

1) Записать в вектор пути файлов в папке.
2) Считать все данные из каждого файла и записать в очередь
3) Распарсить и записать в очередь
4) Записать все данные из очереди в файл out


----------------------------------------------

Есть несколько режимов:
  1) Запуск без консоли
    Начнёт работать в режиме
  2) Запуск черезь консоль
    mthreads.exe -h                                           
      Откроет help menu
    mthreads -create_files <count> <length of string> <count of delimetres> <folder_name>
      Генерация файлов с данными с заданными параметрами.
    mthreads -transfer <source_folder> <destination_file>
      Запуск основной части программы:
        1.1) Считывание данных с файлов и запсь в очередь в одном потоке. Поток 1 потому, из-за устройства HDD (больше - нет смысла).
        1.2) Парсинг и запись в очередь в другом потоке(сразу несколько). Количество было выбрано 2*количество аппаратных потоков, потому что больше - нет смысла.
        1.3) Запись из очереди в файл в ещё 1 потоке. Поток 1 для простоты реализации. В ветке improving_speed хотел сделать синхронизаци. чтобы могли писать сразу несколько потоков.
    mthreads -thread 1 <source_folder> <destination_file>
      Всё происходит в одном потоке main.
    mthreads -thread 3 <source_folder> <destination_file>
      Тоже самое, что и -transfer, но парсинг происходит в одном потоке, а не сразу в нескольких.
      
      
      
Что я бы хотел дополнить:
  1) Протестировать считывание/запись разными командами и выбрать наиболее подходящее. Я почитал, что считывание таких данных будет быстрее, используя mmap. Потому что он сразу отображает файл в виртуальную память + получаю  сразу все данные с файла, итерироваться по строкам можно при помощи инкрементировании указателя, что, на самом деле, не требуется.
  2) Запись в файл тоже при помощи mmap, сразу всю очередь, а не по элементу.
  3) Улучшить алгоритм парсинга, считывания.
  4) Узкие места - очереди. Надо как-то избавиться. 
  5) Наибольшее время, занимает часть кода с записью из очереди в файл.
  6) Иногда крашится при парсинге в несколько потоков.
  7) futers иногда не освобождаются, потому что застревают между while-ами.
--------------------------------------------------------------------------------------

Структура файла с данными:\n
\n
JXpgSkSjBb8QRKGcEr9EjJT8GSvwdkPZXdphPRP5Ylz86bsQemdPcNj711hzV7fdWFcRBREldWDB\n
R\n
B\n
f\n
n\n
8\n
W\n
S\n
\n
Структура out файла:\n
\n
[C:\Users\Администратор\source\repos\mthreads\mthreads\test\0.txt]:\n
rAQBc8W\n
a1xVP\n
vJcrgRY\n
Tiiz\n
trQF69AzBlax3CF3EDNhm3\n
oLBPh71Yex\n
ieaoEiIgxI\n
4a\n
dREbbSqWy6yhKIDCdJ\n
yapnxrpMCAR\n
\n
[C:\Users\Администратор\source\repos\mthreads\mthreads\test\1.txt]:\n
JXpg\n
k\n
jv
bv
Q\n
KGcEr9EjJT\n
G\n
vwdkPZXdphP\n
P5Ylz\n
6bsQemdPcNj711hzV7\n
d\n
Fc\n
Eld\n
D\n
\n
[C:\Users\Администратор\source\repos\mthreads\mthreads\test\10.txt]:\n
E6u2JFQZWdmOoBGFtc6M\n
R3n\n
mqu\n
eynZ6eXUQ3\n
runJ2YW1wzDf3Y9XBIr9TbJbrhW\n

